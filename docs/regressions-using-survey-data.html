<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>A Compendium Of Statistics Questions</title>
  <meta name="description" content="A compendium of commonly asked statistical questions.">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="A Compendium Of Statistics Questions" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A compendium of commonly asked statistical questions." />
  <meta name="github-repo" content="raubreywhite/raubreywhite.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A Compendium Of Statistics Questions" />
  
  <meta name="twitter:description" content="A compendium of commonly asked statistical questions." />
  

<meta name="author" content="Richard White">


<meta name="date" content="2017-06-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="multiple-imputation.html">
<link rel="next" href="matching.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="/">Home</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Purpose</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="folder-structure.html"><a href="folder-structure.html"><i class="fa fa-check"></i><b>3</b> Folder structure</a></li>
<li class="chapter" data-level="4" data-path="docker.html"><a href="docker.html"><i class="fa fa-check"></i><b>4</b> Docker</a><ul>
<li class="chapter" data-level="4.1" data-path="docker.html"><a href="docker.html#what-is-docker-and-why-is-it-good"><i class="fa fa-check"></i><b>4.1</b> What is Docker, and why is it good?</a></li>
<li class="chapter" data-level="4.2" data-path="docker.html"><a href="docker.html#what-is-repl"><i class="fa fa-check"></i><b>4.2</b> What is REPL?</a></li>
<li class="chapter" data-level="4.3" data-path="docker.html"><a href="docker.html#what-is-vim"><i class="fa fa-check"></i><b>4.3</b> What is VIM?</a></li>
<li class="chapter" data-level="4.4" data-path="docker.html"><a href="docker.html#what-is-vim-slime"><i class="fa fa-check"></i><b>4.4</b> What is vim-slime?</a></li>
<li class="chapter" data-level="4.5" data-path="docker.html"><a href="docker.html#which-docker-containers-should-i-use"><i class="fa fa-check"></i><b>4.5</b> Which Docker containers should I use?</a></li>
<li class="chapter" data-level="4.6" data-path="docker.html"><a href="docker.html#putting-it-all-together"><i class="fa fa-check"></i><b>4.6</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression-vs-anova.html"><a href="linear-regression-vs-anova.html"><i class="fa fa-check"></i><b>5</b> Linear Regression vs ANOVA</a><ul>
<li class="chapter" data-level="5.1" data-path="linear-regression-vs-anova.html"><a href="linear-regression-vs-anova.html#summary"><i class="fa fa-check"></i><b>5.1</b> Summary</a></li>
<li class="chapter" data-level="5.2" data-path="linear-regression-vs-anova.html"><a href="linear-regression-vs-anova.html#empirical-evidence"><i class="fa fa-check"></i><b>5.2</b> Empirical evidence</a></li>
<li class="chapter" data-level="5.3" data-path="linear-regression-vs-anova.html"><a href="linear-regression-vs-anova.html#statistical-proof"><i class="fa fa-check"></i><b>5.3</b> Statistical proof</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="outcomes.html"><a href="outcomes.html"><i class="fa fa-check"></i><b>6</b> Outcomes</a><ul>
<li class="chapter" data-level="6.1" data-path="outcomes.html"><a href="outcomes.html#length-of-stay"><i class="fa fa-check"></i><b>6.1</b> Length of stay</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="multiple-imputation.html"><a href="multiple-imputation.html"><i class="fa fa-check"></i><b>7</b> Multiple imputation</a><ul>
<li class="chapter" data-level="7.1" data-path="multiple-imputation.html"><a href="multiple-imputation.html#longitudinal-data"><i class="fa fa-check"></i><b>7.1</b> Longitudinal data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regressions-using-survey-data.html"><a href="regressions-using-survey-data.html"><i class="fa fa-check"></i><b>8</b> Regressions using survey data</a><ul>
<li class="chapter" data-level="8.1" data-path="regressions-using-survey-data.html"><a href="regressions-using-survey-data.html#literature-summary"><i class="fa fa-check"></i><b>8.1</b> Literature summary</a></li>
<li class="chapter" data-level="8.2" data-path="regressions-using-survey-data.html"><a href="regressions-using-survey-data.html#setup"><i class="fa fa-check"></i><b>8.2</b> Setup</a></li>
<li class="chapter" data-level="8.3" data-path="regressions-using-survey-data.html"><a href="regressions-using-survey-data.html#case-control-studies"><i class="fa fa-check"></i><b>8.3</b> Case-control studies</a></li>
<li class="chapter" data-level="8.4" data-path="regressions-using-survey-data.html"><a href="regressions-using-survey-data.html#oversampling-a-population-with-a-higher-level-of-the-outcome"><i class="fa fa-check"></i><b>8.4</b> Oversampling a population with a higher level of the outcome</a></li>
<li class="chapter" data-level="8.5" data-path="regressions-using-survey-data.html"><a href="regressions-using-survey-data.html#oversampling-a-population-with-a-higher-level-of-the-outcome-and-exposure"><i class="fa fa-check"></i><b>8.5</b> Oversampling a population with a higher level of the outcome and exposure</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="matching.html"><a href="matching.html"><i class="fa fa-check"></i><b>9</b> Matching</a><ul>
<li class="chapter" data-level="9.1" data-path="matching.html"><a href="matching.html#in-case-control-studies"><i class="fa fa-check"></i><b>9.1</b> In case control studies</a></li>
<li class="chapter" data-level="9.2" data-path="matching.html"><a href="matching.html#in-non-case-control-studies"><i class="fa fa-check"></i><b>9.2</b> In non-case control studies</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Compendium Of Statistics Questions</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="regressions-using-survey-data" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Regressions using survey data</h1>
<div id="literature-summary" class="section level2">
<h2><span class="header-section-number">8.1</span> Literature summary</h2>
<ul>
<li>Endogenous sampling can be thought of as cases where the regression error term is related to the sampling criteria <span class="citation">(Friedman <a href="#ref-friedman_tools_2013">2013</a>, <span class="citation">Solon, Haider, and Wooldridge (<a href="#ref-solon_what_2013">2013</a>)</span>, <span class="citation">Fuller (<a href="#ref-fuller_sampling_2009">2009</a>)</span>)</span></li>
<li>In the presence of endogenous sampling, unweighted estimates may be biased, but will be corrected by weighting by the inverse probability of selection <span class="citation">(Friedman <a href="#ref-friedman_tools_2013">2013</a>, <span class="citation">Solon, Haider, and Wooldridge (<a href="#ref-solon_what_2013">2013</a>)</span>, <span class="citation">Fuller (<a href="#ref-fuller_sampling_2009">2009</a>)</span>)</span></li>
<li>In the presence of endogenous sampling, if the sampling probability varies across certain strata and those strata indicators are included in the estimating equation, then the probability of selection should no longer be related to the error term. Subsequently, weighting is not necessary <span class="citation">(Friedman <a href="#ref-friedman_tools_2013">2013</a>, <span class="citation">Solon, Haider, and Wooldridge (<a href="#ref-solon_what_2013">2013</a>)</span>, <span class="citation">Fuller (<a href="#ref-fuller_sampling_2009">2009</a>)</span>)</span></li>
<li>In the case of a linear regression model that correctly specifies the conditional mean, the sampling would be exogenous if the sampling probabilities are independent of the error term in the regression equation. This would be the case, for example, if the sampling probabilities vary only on the basis of explanatory variables <span class="citation">(Solon, Haider, and Wooldridge <a href="#ref-solon_what_2013">2013</a>)</span></li>
<li>More generally, the issue is whether the sampling is independent of the dependent variable conditional on the explanatory variables <span class="citation">(Solon, Haider, and Wooldridge <a href="#ref-solon_what_2013">2013</a>)</span></li>
<li>Weighting does not correct for confounding. Adjusting for confounders is still necessary.</li>
<li>Weighting is useful when the regression model that accounts for sampling probabilities does not make any sense (e.g. in the case-control scenario).</li>
</ul>
</div>
<div id="setup" class="section level2">
<h2><span class="header-section-number">8.2</span> Setup</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FormatNicely &lt;-<span class="st"> </span>function(x,<span class="dt">dp=</span><span class="dv">3</span>){
  <span class="kw">formatC</span>(x,<span class="dt">digits=</span>dp,<span class="dt">format=</span><span class="st">&quot;f&quot;</span>)
}

ConvertFitToResults &lt;-<span class="st"> </span>function(fit,dataName,analysisName){
  r &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">coef</span>(<span class="kw">summary</span>(fit)))[-<span class="dv">1</span>,-<span class="kw">c</span>(<span class="dv">3</span>:<span class="dv">4</span>),drop=F]
  r[,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s [%s]&quot;</span>,
                   <span class="kw">FormatNicely</span>(r[,<span class="dv">1</span>],<span class="dt">dp=</span><span class="dv">3</span>),
                   <span class="kw">FormatNicely</span>(r[,<span class="dv">2</span>],<span class="dt">dp=</span><span class="dv">3</span>))
  r &lt;-<span class="st"> </span>r[,<span class="dv">1</span>,drop=F]
  r &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(r))
  r$data &lt;-<span class="st"> </span>dataName
  r$analysis &lt;-<span class="st"> </span>analysisName
  <span class="kw">return</span>(r)
}</code></pre></div>
</div>
<div id="case-control-studies" class="section level2">
<h2><span class="header-section-number">8.3</span> Case-control studies</h2>
<p>In this case study we will create a dataset <code>popData</code> that has a 1:1 linear relationship between the continuous exposure <code>x</code> and and the continuous outcome <code>y</code>. We also dichotomise <code>y</code> into a binary outcome <code>yBinary</code>.</p>
<p>We then create a dataset <code>casecontrolData</code> that oversamples cases 5x higher than is found in the normal population <code>popData</code>. We will then run linear regressions in the original population dataset and the case-control dataset and see how the effect estimates are affected by oversampling cases.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)

<span class="co"># Creating population dataset</span>
x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">100000</span>)
popData &lt;-<span class="st"> </span><span class="kw">data.table</span>(x)
popData[,y:<span class="er">=</span>x+<span class="kw">rnorm</span>(.N)]

<span class="co"># Binary outcome</span>
popData[,yBinary:<span class="er">=</span><span class="dv">0</span>]
popData[y&gt;<span class="dv">1</span>,yBinary:<span class="er">=</span><span class="dv">1</span>]
popData[,oversampled:<span class="er">=</span>yBinary]

popData[,inclusionProb :<span class="er">=</span><span class="st"> </span><span class="dv">5</span>]
popData[oversampled==<span class="dv">0</span>, inclusionProb:<span class="er">=</span><span class="dv">1</span>]

<span class="co"># Case control dataset</span>
cases &lt;-<span class="st"> </span>popData[yBinary==<span class="dv">1</span>]
controls &lt;-<span class="st"> </span>popData[yBinary==<span class="dv">0</span>]

<span class="co"># Cases are sampled 5x higher than normal</span>
casecontrolData &lt;-<span class="st"> </span><span class="kw">rbind</span>(cases,cases,cases,cases,cases,controls)
casecontrolData[,id:<span class="er">=</span><span class="dv">1</span>:.N]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Full population data set, unweighted regression</span>
res &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>,<span class="dv">10</span>)
fit &lt;-<span class="st"> </span><span class="kw">glm</span>(y~x,<span class="dt">data=</span>popData)
res[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit,<span class="dt">dataName=</span><span class="st">&quot;Pop&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted&quot;</span>)
res[[<span class="dv">1</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$oversampled), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (case control with 5x), unweighted regression</span>
fit &lt;-<span class="st"> </span><span class="kw">glm</span>(y~x,<span class="dt">data=</span>casecontrolData)
res[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit,<span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted&quot;</span>)
res[[<span class="dv">2</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$oversampled), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (case control with 5x), weighted regression</span>
des &lt;-<span class="st"> </span>survey::<span class="kw">svydesign</span>(<span class="dt">id=</span>~id,<span class="dt">prob=</span>~inclusionProb,<span class="dt">data=</span>casecontrolData)
fit &lt;-<span class="st"> </span>survey::<span class="kw">svyglm</span>(y~x, <span class="dt">design=</span>des)
res[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit,<span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Weighted&quot;</span>)
res[[<span class="dv">3</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$oversampled), <span class="dt">dp=</span><span class="dv">2</span>)

res &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(res,<span class="dt">fill=</span>T)
<span class="kw">setcolorder</span>(res, <span class="kw">c</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;analysis&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;correlation&quot;</span>))
<span class="kw">setnames</span>(res, <span class="kw">c</span>(<span class="st">&quot;Data&quot;</span>, <span class="st">&quot;Analysis&quot;</span>, <span class="st">&quot;coef(x) [sd(coef(x))]&quot;</span>, <span class="st">&quot;Correlation*&quot;</span>))

knitr::<span class="kw">kable</span>(
  res, <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,
  <span class="dt">caption =</span> <span class="st">&#39;Effects of weights on linear regression coefficient estimates. (*Correlation between residuals and sampling probability).&#39;</span>
)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-5">Table 8.1: </span>Effects of weights on linear regression coefficient estimates. (*Correlation between residuals and sampling probability).</caption>
<thead>
<tr class="header">
<th align="left">Data</th>
<th align="left">Analysis</th>
<th align="left">coef(x) [sd(coef(x))]</th>
<th align="left">Correlation*</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Pop</td>
<td align="left">Unweighted</td>
<td align="left">0.989 [0.011]</td>
<td align="left">0.74</td>
</tr>
<tr class="even">
<td align="left">Sample</td>
<td align="left">Unweighted</td>
<td align="left">0.910 [0.007]</td>
<td align="left">0.77</td>
</tr>
<tr class="odd">
<td align="left">Sample</td>
<td align="left">Weighted</td>
<td align="left">0.989 [0.009]</td>
<td align="left">0.71</td>
</tr>
</tbody>
</table>
<p>We can see here that in the presence of endogenous sampling, the sampling probability is highly correlated with the regression error term. By weighting the data by the inverse probability of selection we obtain unbiased estimates of <code>coef(x)</code>.</p>
</div>
<div id="oversampling-a-population-with-a-higher-level-of-the-outcome" class="section level2">
<h2><span class="header-section-number">8.4</span> Oversampling a population with a higher level of the outcome</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)

<span class="co"># Creating population dataset</span>
x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">100000</span>)
popData &lt;-<span class="st"> </span><span class="kw">data.table</span>(x)
popData[,poor:<span class="er">=</span><span class="dv">0</span>]
popData[<span class="dv">1</span>:<span class="dv">10000</span>,poor:<span class="er">=</span><span class="dv">1</span>]
popData[,bmi:<span class="er">=</span><span class="dv">22+1</span>*x<span class="dv">+5</span>*poor+<span class="kw">rnorm</span>(.N)*<span class="dv">2</span>]

<span class="co"># Oversampled poor dataset</span>
poor &lt;-<span class="st"> </span>popData[poor==<span class="dv">1</span>]
notpoor &lt;-<span class="st"> </span>popData[poor==<span class="dv">0</span>]

<span class="co"># Poor people are sampled 5x higher than not-poor</span>
oversampledData &lt;-<span class="st"> </span><span class="kw">rbind</span>(poor,poor,poor,poor,poor,notpoor)
oversampledData[,id:<span class="er">=</span><span class="dv">1</span>:.N]

<span class="co"># Probability of inclusion</span>
oversampledData[,inclusionProb :<span class="er">=</span><span class="st"> </span><span class="dv">5</span>]
oversampledData[poor==<span class="dv">0</span>, inclusionProb:<span class="er">=</span><span class="dv">1</span>]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Full population data set, unweighted regression</span>
res &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>,<span class="dv">10</span>)
res[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span><span class="kw">glm</span>(bmi~x,<span class="dt">data=</span>popData),
                                <span class="dt">dataName=</span><span class="st">&quot;Pop&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted&quot;</span>)
res[[<span class="dv">1</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (poor oversampled 5x), unweighted regression</span>
res[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span><span class="kw">glm</span>(bmi~x,<span class="dt">data=</span>oversampledData),
                                <span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted&quot;</span>)
res[[<span class="dv">2</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (poor oversampled 5x), weighted regression</span>
des &lt;-<span class="st"> </span>survey::<span class="kw">svydesign</span>(<span class="dt">id=</span>~id,<span class="dt">prob=</span>~inclusionProb,<span class="dt">data=</span>oversampledData)
res[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span>survey::<span class="kw">svyglm</span>(bmi~x, <span class="dt">design=</span>des),
                                <span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Weighted&quot;</span>)
res[[<span class="dv">3</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Full population data set, unweighted regression + strata indicator</span>
res[[<span class="dv">4</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span><span class="kw">glm</span>(bmi~x+poor,<span class="dt">data=</span>popData),
                                <span class="dt">dataName=</span><span class="st">&quot;Pop&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted+Strata&quot;</span>)
res[[<span class="dv">4</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (poor oversampled 5x), unweighted regression + strata indicator</span>
res[[<span class="dv">5</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span><span class="kw">glm</span>(bmi~x+poor,<span class="dt">data=</span>oversampledData),
                                <span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted+Strata&quot;</span>)
res[[<span class="dv">5</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (poor oversampled 5x), weighted regression + strata indicator</span>
des &lt;-<span class="st"> </span>survey::<span class="kw">svydesign</span>(<span class="dt">id=</span>~id,<span class="dt">prob=</span>~inclusionProb,<span class="dt">data=</span>oversampledData)
res[[<span class="dv">6</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span>survey::<span class="kw">svyglm</span>(bmi~x+poor, <span class="dt">design=</span>des),
                                <span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Weighted+Strata&quot;</span>)
res[[<span class="dv">6</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

res &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(res,<span class="dt">fill=</span>T)
<span class="kw">setcolorder</span>(res,<span class="kw">c</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;analysis&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;poor&quot;</span>, <span class="st">&quot;correlation&quot;</span>))
<span class="kw">setnames</span>(res,<span class="kw">c</span>(<span class="st">&quot;Data&quot;</span>, <span class="st">&quot;Analysis&quot;</span>, <span class="st">&quot;coef(x) [sd(coef(x))]&quot;</span>, <span class="st">&quot;coef(poor) [sd(coef(poor))]&quot;</span>, <span class="st">&quot;Correlation*&quot;</span>))

knitr::<span class="kw">kable</span>(
  res, <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,
  <span class="dt">caption =</span> <span class="st">&#39;Effects of weights on linear regression coefficient estimates. (*Correlation between residuals and sampling probability).&#39;</span>
)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-7">Table 8.2: </span>Effects of weights on linear regression coefficient estimates. (*Correlation between residuals and sampling probability).</caption>
<thead>
<tr class="header">
<th align="left">Data</th>
<th align="left">Analysis</th>
<th align="left">coef(x) [sd(coef(x))]</th>
<th align="left">coef(poor) [sd(coef(poor))]</th>
<th align="left">Correlation*</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Pop</td>
<td align="left">Unweighted</td>
<td align="left">1.060 [0.027]</td>
<td align="left">NA</td>
<td align="left">0.60</td>
</tr>
<tr class="even">
<td align="left">Sample</td>
<td align="left">Unweighted</td>
<td align="left">1.108 [0.029]</td>
<td align="left">NA</td>
<td align="left">0.77</td>
</tr>
<tr class="odd">
<td align="left">Sample</td>
<td align="left">Weighted</td>
<td align="left">1.060 [0.023]</td>
<td align="left">NA</td>
<td align="left">0.58</td>
</tr>
<tr class="even">
<td align="left">Pop</td>
<td align="left">Unweighted+Strata</td>
<td align="left">1.032 [0.022]</td>
<td align="left">5.012 [0.021]</td>
<td align="left">0.00</td>
</tr>
<tr class="odd">
<td align="left">Sample</td>
<td align="left">Unweighted+Strata</td>
<td align="left">1.036 [0.018]</td>
<td align="left">5.012 [0.011]</td>
<td align="left">0.00</td>
</tr>
<tr class="even">
<td align="left">Sample</td>
<td align="left">Weighted+Strata</td>
<td align="left">1.032 [0.021]</td>
<td align="left">5.012 [0.011]</td>
<td align="left">0.00</td>
</tr>
</tbody>
</table>
<p>We can see here that in the first three models the sampling probability is highly correlated with the regression error term. Models 1 and 3 provide unbiased estimates (through exogenous sampling and weighting, respectively.) In models 4 through to 6, we included an explanatory variable <code>poor</code> to account for the varying sampling probabilities. Subsequently, the sampling probability is no longer correlated with the regression error term, and we obtain unbiased estimates.</p>
</div>
<div id="oversampling-a-population-with-a-higher-level-of-the-outcome-and-exposure" class="section level2">
<h2><span class="header-section-number">8.5</span> Oversampling a population with a higher level of the outcome and exposure</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(data.table)

<span class="co"># Creating population dataset</span>
x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">100000</span>)
popData &lt;-<span class="st"> </span><span class="kw">data.table</span>(x)
popData[,poor:<span class="er">=</span><span class="dv">0</span>]
popData[<span class="dv">1</span>:<span class="dv">10000</span>,poor:<span class="er">=</span><span class="dv">1</span>]
popData[,x:<span class="er">=</span>x<span class="dv">+2</span>*poor]
popData[,bmi:<span class="er">=</span><span class="dv">22+1</span>*x<span class="dv">+5</span>*poor+<span class="kw">rnorm</span>(.N)*<span class="dv">2</span>]

<span class="co"># Oversampled poor dataset</span>
poor &lt;-<span class="st"> </span>popData[poor==<span class="dv">1</span>]
notpoor &lt;-<span class="st"> </span>popData[poor==<span class="dv">0</span>]

<span class="co"># Poor people are sampled 5x higher than not-poor</span>
oversampledData &lt;-<span class="st"> </span><span class="kw">rbind</span>(poor,poor,poor,poor,poor,notpoor)
oversampledData[,id:<span class="er">=</span><span class="dv">1</span>:.N]

<span class="co"># Probability of inclusion</span>
oversampledData[,inclusionProb :<span class="er">=</span><span class="st"> </span><span class="dv">5</span>]
oversampledData[poor==<span class="dv">0</span>, inclusionProb:<span class="er">=</span><span class="dv">1</span>]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Full population data set, unweighted regression</span>
res &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>,<span class="dv">10</span>)
res[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span><span class="kw">glm</span>(bmi~x,<span class="dt">data=</span>popData),
                                <span class="dt">dataName=</span><span class="st">&quot;Pop&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted&quot;</span>)
res[[<span class="dv">1</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (poor oversampled 5x), unweighted regression</span>
res[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span><span class="kw">glm</span>(bmi~x,<span class="dt">data=</span>oversampledData),
                                <span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted&quot;</span>)
res[[<span class="dv">2</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (poor oversampled 5x), weighted regression</span>
des &lt;-<span class="st"> </span>survey::<span class="kw">svydesign</span>(<span class="dt">id=</span>~id,<span class="dt">prob=</span>~inclusionProb,<span class="dt">data=</span>oversampledData)
res[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span>survey::<span class="kw">svyglm</span>(bmi~x, <span class="dt">design=</span>des),
                                <span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Weighted&quot;</span>)
res[[<span class="dv">3</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Full population data set, unweighted regression + strata indicator</span>
res[[<span class="dv">4</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span><span class="kw">glm</span>(bmi~x+poor,<span class="dt">data=</span>popData),
                                <span class="dt">dataName=</span><span class="st">&quot;Pop&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted+Strata&quot;</span>)
res[[<span class="dv">4</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (poor oversampled 5x), unweighted regression + strata indicator</span>
res[[<span class="dv">5</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span><span class="kw">glm</span>(bmi~x+poor,<span class="dt">data=</span>oversampledData),
                                <span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Unweighted+Strata&quot;</span>)
res[[<span class="dv">5</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

<span class="co"># Biased dataset (poor oversampled 5x), weighted regression + strata indicator</span>
des &lt;-<span class="st"> </span>survey::<span class="kw">svydesign</span>(<span class="dt">id=</span>~id,<span class="dt">prob=</span>~inclusionProb,<span class="dt">data=</span>oversampledData)
res[[<span class="dv">6</span>]] &lt;-<span class="st"> </span><span class="kw">ConvertFitToResults</span>(fit &lt;-<span class="st"> </span>survey::<span class="kw">svyglm</span>(bmi~x+poor, <span class="dt">design=</span>des),
                                <span class="dt">dataName=</span><span class="st">&quot;Sample&quot;</span>,<span class="dt">analysisName=</span><span class="st">&quot;Weighted+Strata&quot;</span>)
res[[<span class="dv">6</span>]]$correlation &lt;-<span class="st"> </span><span class="kw">FormatNicely</span>(<span class="kw">cor</span>(<span class="kw">resid</span>(fit),fit$data$poor), <span class="dt">dp=</span><span class="dv">2</span>)

res &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(res,<span class="dt">fill=</span>T)
<span class="kw">setcolorder</span>(res,<span class="kw">c</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;analysis&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;poor&quot;</span>, <span class="st">&quot;correlation&quot;</span>))
<span class="kw">setnames</span>(res,<span class="kw">c</span>(<span class="st">&quot;Data&quot;</span>, <span class="st">&quot;Analysis&quot;</span>, <span class="st">&quot;coef(x) [sd(coef(x))]&quot;</span>, <span class="st">&quot;coef(poor) [sd(coef(poor))]&quot;</span>, <span class="st">&quot;Correlation*&quot;</span>))

knitr::<span class="kw">kable</span>(
  res, <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,
  <span class="dt">caption =</span> <span class="st">&#39;Effects of weights on linear regression coefficient estimates. (*Correlation between residuals and sampling probability).&#39;</span>
)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-9">Table 8.3: </span>Effects of weights on linear regression coefficient estimates. (*Correlation between residuals and sampling probability).</caption>
<thead>
<tr class="header">
<th align="left">Data</th>
<th align="left">Analysis</th>
<th align="left">coef(x) [sd(coef(x))]</th>
<th align="left">coef(poor) [sd(coef(poor))]</th>
<th align="left">Correlation*</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Pop</td>
<td align="left">Unweighted</td>
<td align="left">3.026 [0.010]</td>
<td align="left">NA</td>
<td align="left">0.13</td>
</tr>
<tr class="even">
<td align="left">Sample</td>
<td align="left">Unweighted</td>
<td align="left">3.286 [0.006]</td>
<td align="left">NA</td>
<td align="left">0.09</td>
</tr>
<tr class="odd">
<td align="left">Sample</td>
<td align="left">Weighted</td>
<td align="left">3.026 [0.006]</td>
<td align="left">NA</td>
<td align="left">0.13</td>
</tr>
<tr class="even">
<td align="left">Pop</td>
<td align="left">Unweighted+Strata</td>
<td align="left">1.017 [0.022]</td>
<td align="left">4.951 [0.048]</td>
<td align="left">0.00</td>
</tr>
<tr class="odd">
<td align="left">Sample</td>
<td align="left">Unweighted+Strata</td>
<td align="left">1.033 [0.018]</td>
<td align="left">4.919 [0.039]</td>
<td align="left">0.00</td>
</tr>
<tr class="even">
<td align="left">Sample</td>
<td align="left">Weighted+Strata</td>
<td align="left">1.017 [0.021]</td>
<td align="left">4.951 [0.043]</td>
<td align="left">0.00</td>
</tr>
</tbody>
</table>
<p>We can see here that in the first three models the sampling probability is highly correlated with the regression error term. Models 1 and 3 provide estimates unbiased due to the endogenous sampling (through exogenous sampling and weighting, respectively), however, these estimates are still biased due to confounding. In models 4 through to 6, we included an explanatory variable <code>poor</code> to account for the varying sampling probabilities. Subsequently, the sampling probability is no longer correlated with the regression error term, and we obtain unbiased estimates.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-friedman_tools_2013">
<p>Friedman, Jed. 2013. “Tools of the Trade: When to Use Those Sample Weights.” <a href="http://blogs.worldbank.org/impactevaluations/tools-of-the-trade-when-to-use-those-sample-weights" class="uri">http://blogs.worldbank.org/impactevaluations/tools-of-the-trade-when-to-use-those-sample-weights</a>.</p>
</div>
<div id="ref-solon_what_2013">
<p>Solon, Gary, Steven Haider, and Jeffrey Wooldridge. 2013. “What Are We Weighting For?” w18859. Cambridge, MA: National Bureau of Economic Research. <a href="http://www.nber.org/papers/w18859.pdf" class="uri">http://www.nber.org/papers/w18859.pdf</a>.</p>
</div>
<div id="ref-fuller_sampling_2009">
<p>Fuller, Wayne A. 2009. <em>Sampling Statistics</em>. Hoboken, NJ, USA: John Wiley &amp; Sons, Inc. <a href="http://doi.wiley.com/10.1002/9780470523551" class="uri">http://doi.wiley.com/10.1002/9780470523551</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="multiple-imputation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="matching.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/raubreywhite/raubreywhite.github.io/edit/master/xsrc_book/07-survey-data.Rmd",
"text": "Edit"
},
"download": ["a-compendium-of-statistics-questions.pdf"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
